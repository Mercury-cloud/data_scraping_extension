var bit155=bit155||{};bit155.scraper=bit155.scraper||{};bit155.scraper.viewer=function(e,t){var t=t||{};if(!e){chrome.tabs.getSelected(undefined,function(e){if(e){bit155.scraper.viewer(e,t)}});return}if(e.url.indexOf("https://chrome.google.com/extensions")==0||e.url.indexOf("chrome://")==0){alert("Scraper is not permitted to work on the Google Chrome extensions page for security reasons.");return}chrome.windows.create({url:chrome.extension.getURL(utilityFn.dev_viewer!==undefined?utilityFn.dev_viewer:"viewer.html")+"?tab="+e.id+"&recipe="+encodeURIComponent(JSON.stringify(t)),type:"popup",width:Math.max(1200,parseInt(localStorage["viewer.width"]||screen.width*.8,10)),height:Math.max(600,parseInt(localStorage["viewer.height"]||screen.height*.8,10))})};bit155.scraper.recipes=bit155.attr({initial:JSON.parse(localStorage["recipes"]||localStorage["viewer.recipes"]||"null"),filter:function(e){if(e&&!$.isArray(e)){throw new Error("Recipe must be an array.")}return e},callback:function(e){localStorage["recipes"]=e?JSON.stringify(e):null}});bit155.scraper.xpathForNode=function(e){var t=$(e).xpath(),i=/^(.*)(\[\d+\])([^\[\]]*)$/,n=/^(\/+[^\/]+)(.*)$/,r,l,a;while(r=i.exec(t)){l=bit155.scraper.select(document,t,"xpath");if(l.length>1){break}t=r[1]+r[3]}if(!l){return t}while(r=n.exec(t)){a=bit155.scraper.select(document,"/"+r[2],"xpath")||[];if(a.length!==l.length){break}t="/"+r[2]}return t};bit155.scraper.optionsForSelection=function(e,t,i){var n={},r,l,a,u;i=i||window.document;if(t){r=$([e,t]).commonAncestor()}else{r=$(e).closest("*")}if(r&&r.length>0){l=r.get(0).tagName.toLowerCase();if(l==="table"||l==="tbody"||l==="thead"||l==="tfoot"){r=$(e).closest("tr")}else if(l==="dl"){r=r.find("dt").first()}else if(l==="ul"||l==="ol"){r=r.find("li").first()}}n.language="jquery";n.selector="";n.attributes=[];if(r&&r.length>0){u=r.get(0);l=u.tagName.toLowerCase();a=$.trim(u.getAttribute("class"));n.selector=l;n.language="xpath";n.selector=bit155.scraper.xpathForNode(u);if(l==="tr"){var o=function(){var e=r.closest("table");var t=r.children().length;var i=e.find("tr").first();var n;if(i&&i.children("th").length==t){n=i}else{n=r}return n.children().map(function(e,t){if(t.tagName==="TH"){return $(t).text()}else{return"Column "+(e+1)}})}();$.each(o,function(e,t){t=t.replace(/\t/gm,"").replace(/\n+/gm,"\n");n.attributes.push({xpath:"*["+(e+1)+"]",name:t})});n.selector=n.selector+"[td]"}else if(l==="a"){n.attributes.push({xpath:".",name:"Link"});n.attributes.push({xpath:"@href",name:"URL"})}else if(l==="img"){n.attributes.push({xpath:"@title",name:"Title"});n.attributes.push({xpath:"@src",name:"Source"})}else if(l==="dt"){n.attributes.push({xpath:".",name:"Term"});n.attributes.push({xpath:"./following-sibling::dd",name:"Definition"})}else{n.attributes.push({xpath:".",name:"Text"})}}return n};bit155.scraper.select=function(e,t,i){if(typeof e!=="object"){throw"Context object is required."}if(typeof t!=="string"){throw"Selector string is required."}if(t.trim()==="")return $();if(i==="xpath"){var n=document.evaluate(t,e||document,null,XPathResult.ANY_TYPE,null);var r,l,a=[];for(r=0;l=n.iterateNext();r++){a.push(l)}return $(a)}else if(i==="jquery"){return $(e).find(t)}else{throw new Error("Unsupported selector language: "+i)}};bit155.scraper.scrape=function(e){var t=e["selector"];var i=e["attributes"]||[];var n=e.filters||[];var r=[];if(e.language==="xpath"){if(e.selector.trim()==="")e.selector="//body";bit155.scraper.select(document,e.selector,e.language).each(function(e,t){var n=$(t);var l=[];var a;if(i){var u=null;$.each(i,function(){var e=null;this.xpath=this.xpath||this.query;if(this.method==="html"||this.method===2){a=document.evaluate(this.xpath,t,null,XPathResult.ANY_TYPE,null);if(null!==a&&a.invalidIteratorState===false){var i=a.iterateNext();if(i!==null)e=i.innerHTML}}else if(this.method==="iframe"){var n=this.xpath.split(" ");a=document.evaluate(n[0],t,null,XPathResult.ANY_TYPE,null);if(null!==a&&a.invalidIteratorState===false){var r=a.iterateNext();if(r!==null){var u=r.contentDocument.evaluate(n[1],r.contentDocument,null,XPathResult.ANY_TYPE,null);if(null!==u&&u.invalidIteratorState===false){var o=u.iterateNext();if(o!==null)e="<div>"+o.innerHTML+"</div>";else e=""}else e="XPath for inside IFRAME if not correct"}else e="IFRAME not found"}}else e=document.evaluate(this.xpath,t,null,XPathResult.STRING_TYPE,null).stringValue;if(e===null||e===undefined)e="";else if(typeof e==="string")e=e.trim();else e=e.toString().trim();e=e.replace(/\t/gm,"").replace(/\n+/gm,"\n");l.push(e)})}r.push({xpath:n.xpath(),values:l})})}else if(e.language==="jquery"){var l=JSON.parse(JSON.stringify(e));l.cols=l.attributes;delete l.attributes;l.row={query:l.selector};delete l.selector;l.next={query:l.next_page,type:"click"};l.language=1;l.cols.forEach(function(e){if(e.method=="text")e.method=0;else if(e.method=="text_direct")e.method=1;else if(e.method=="html")e.method=2;else if(e.method=="url")e.method=3;else if(e.method=="src")e.method=4;else if(e.method=="attribute")e.method=5});try{var a=new window.dataminerfd92ddf997994d9cae8c62a3b536b803.Scrape;a.b();var u=a.p(l);var o=u.data||u.rows;o.forEach(function(e){r.push({values:e})})}catch(e){r=[]}}$.each(n,function(e,t){if(t==="empty"){r=r.filter(function(e){for(var t=0;t<e.values.length;t++){if($.trim(e.values[t])!==""){return true}}return false})}});return r};
//# sourceMappingURL=scraper.js.map